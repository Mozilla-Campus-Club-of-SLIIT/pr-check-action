name: PR Check
author: Mozilla-Campus-Club-of-SLIIT
description: Ensures PR compliance with project guidelines
inputs:
  token:
    description: GITHUB_TOKEN or repo scoped PAT
    required: false
    default: ${{ github.token }}
  comment-author:
    description: The account's name which the command check review should be published. Use [bot] suffix for apps.
    required: false
    default: github-actions[bot]
  no-closing-message:
    description: Custom error message when there are no closing statements
    required: false
  unchecked-boxes-message:
    description: Custom error message when there are unchecked check boxes
    required: false
  unchecked-box-group-message:
    description: Custom error message for each checkbox group.
    required: false
  success-message:
    description: Custom success message
    required: false

runs:
  using: composite
  steps:
    - name: Find Comment
      uses: peter-evans/find-comment@v3
      id: fc
      with:
        issue-number: ${{ github.event.pull_request.number }}
        comment-author: ${{ inputs.comment-author }}
        token: ${{ inputs.token }}

    - run: echo Bot comment ${{ steps.fc.outputs.comment-id }}
    - run: echo pull body "${{ github.event.pull_request.body }}"
      shell: bash

    - name: Check python version
      run: python --version
      shell: bash

    - name: Check PR
      id: check
      run: |
        python ${{ github.action_path }}/index.py > tmp
        echo "output<<EOF" >> $GITHUB_OUTPUT
        cat tmp >> $GITHUB_OUTPUT
        echo "EOF" >> $GITHUB_OUTPUT
      shell: bash
      env:
        PR_DESCRIPTION: ${{ github.event.pull_request.body }}
        NO_CLOSING_MESSAGE: ${{ inputs.no-closing-message }}
        UNCHECKED_BOXES_MESSAGE: ${{ inputs.unchecked-boxes-message }}
        UNCHECKED_BOX_GROUP_MESSAGE: ${{ inputs.unchecked-box-group-message }}
        SUCCESS_MESSAGE: ${{ inputs.success-message }}

    - name: Create comment
      uses: peter-evans/create-or-update-comment@v5
      with:
        issue-number: ${{ github.event.pull_request.number }}
        comment-id: ${{ steps.fc.outputs.comment-id }}
        token: ${{ inputs.token }}
        body: ${{ steps.check.outputs.output }}
        edit-mode: replace
